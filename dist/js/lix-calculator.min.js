var LixCalculator=function(t){function a(){0!==t("#content").length&&t(window).load(function(){this.init()}.bind(this))}var l,o,r,i=t("#lix-calculator-content"),n=[],e=300;return a.prototype.init=function(){setTimeout(function(){tinymce.get("content")&&(o=tinymce.get("content"),o.off("keyup"),this.calculate("visual",this.trimContent(o.getContent({format:"text"})),o.getContent({format:"html"})),o.on("keyup",function(){clearTimeout(l),l=setTimeout(function(){this.calculate("visual",this.trimContent(o.getContent({format:"text"})),o.getContent({format:"html"}))}.bind(this),e)}.bind(this)))}.bind(this),1e3),r=t("textarea#content"),r.off("keyup"),this.calculate("text",this.trimContent(r.val()),wp.editor.autop(r.val())),r.on("keyup",function(){clearTimeout(l),l=setTimeout(function(){this.calculate("text",this.trimContent(r.val()),wp.editor.autop(r.val()))}.bind(this),e)}.bind(this))},a.prototype.trimContent=function(t){return t=t.replace(/<\/?[^>]+(>|$)/g,""),t=t.replace(/\t/g,"")},a.prototype.calculate=function(a,l,o){this.Formula.Total.resetTotal(),t.each(n,function(t,a){a.obj.init(l,o)}.bind(this))},a.prototype.addFormula=function(a,l,o,r){"undefined"==typeof r&&(r=10);var e=!1,u='<div class="col" id="lix-calculator-'+this.slugify(a.formulaId)+'" data-priority="'+r+'">                <label>                    '+l+"                    <small>"+o+'</small>                </label>                <div class="values">                    <em class="value">'+LixCalculatorLang.na+'</em>                    <span class="value">'+LixCalculatorLang.na+"</span>                </div>            </div>",c=i.find(".col").filter(function(){return parseInt(t(this).attr("data-priority"))<=r}).last();c.length||(c=i.find(".col").filter(function(){return parseInt(t(this).attr("data-priority"))>r}).first(),c.length&&(c.before(u),e=!0),c={}),!e&&c.length?c.after(u):e||i.append(u),n.push({obj:a,title:l,description:o})},a.prototype.slugify=function(t){return t.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},a.prototype.getSentences=function(t){return t.trim().length>0&&t.trim().match(/([^\.\!\?]+[\.\?\!]*)/g)?t.trim().match(/([^\.\!\?]+[\.\?\!]*)/g).length:0},a.prototype.getParagraphs=function(t){return t.trim().length>0&&t.trim().split(/[\r\n][\r\n]+/)?t.trim().split(/[\r\n][\r\n]+/).length:0},new a}(jQuery);LixCalculator=LixCalculator||{},LixCalculator.Formula=LixCalculator.Formula||{},LixCalculator.Formula.Headline=function(t){function a(){this.formulaId=l,LixCalculator.addFormula(this,LixCalculatorLang.headline.title,LixCalculatorLang.headline.description,30)}var l="headline";return a.prototype.init=function(t,a){this.calculate(a)},a.prototype.calculate=function(a){var l="#lix-calculator-"+LixCalculator.slugify(this.formulaId),o=this.getParamsFromText(a),r=o.paragraphs/o.headlines,i=r/4*100;LixCalculator.Formula.Total.appendTotal(i,100);var n="#5DAE00",e=LixCalculatorLang.paragraph.good;i<25&&(n="#FF1300",e=LixCalculatorLang.paragraph.low),i>=25&&i<75&&(n="#FFDC00",e=LixCalculatorLang.total.ok),i>=125&&(n="#FF1300",e=LixCalculatorLang.paragraph.high),i=i.toFixed(2)+"%",t(l).find("em.value").html(i).css({color:n}),t(l).find("span.value").html(e).css({color:n})},a.prototype.getParamsFromText=function(t){return{headlines:t.match(/<h(\d)>(.*)?<\/h(\d)>/gi)?t.match(/<h(\d)>(.*)?<\/h(\d)>/gi).length+1:1,paragraphs:t.match(/<p>/gi)?t.match(/<p>/gi).length:0}},new a}(jQuery),LixCalculator=LixCalculator||{},LixCalculator.Formula=LixCalculator.Formula||{},LixCalculator.Formula.Lix=function(t){function a(){this.formulaId=l,LixCalculator.addFormula(this,LixCalculatorLang.lix.title,LixCalculatorLang.lix.description,10)}var l="lix";return a.prototype.init=function(t){var a=this.getParamsFromText(t),l=this.calculate(a.words,a.longWords,a.sentences),o=this.getReadability(l);this.output(l,o)},a.prototype.output=function(a,l){var o="#lix-calculator-"+LixCalculator.slugify(this.formulaId);LixCalculator.Formula.Total.appendTotal(100-a,100),a=100-a+"%",t(o).find("em.value").html(a).css({color:l.textColor}),t(o).find("span.value").html(l.value).css({color:l.textColor})},a.prototype.getReadability=function(t){var a=LixCalculatorLang.na,l="#ddd";return t<30?(a=LixCalculatorLang.lix.very_easy,l="#098400"):t>29&&t<41?(a=LixCalculatorLang.lix.easy,l="#5DAE00"):t>40&&t<51?(a=LixCalculatorLang.lix.moderate,l="#FFDC00"):t>50&&t<61?(a=LixCalculatorLang.lix.hard,l="#FF9600"):t>60&&(a=LixCalculatorLang.lix.very_hard,l="#FF1300"),{value:a,textColor:l}},a.prototype.calculate=function(t,a,l){if(0===t)return 100;var o=t/l+a/t*100;return o.toFixed(2)},a.prototype.getParamsFromText=function(t){return{words:t.trim().length>0&&null!==t.trim().match(/\S+/g)?t.trim().match(/\S+/g).length:0,longWords:t.trim().length>0&&null!==t.trim().match(/(\S+){7,}/g)?t.trim().match(/[\S+]{7,}/g).length:0,sentences:LixCalculator.getSentences(t)}},new a}(jQuery),LixCalculator=LixCalculator||{},LixCalculator.Formula=LixCalculator.Formula||{},LixCalculator.Formula.Moretag=function(t){function a(){this.formulaId=l,LixCalculator.addFormula(this,LixCalculatorLang.moretag.title,LixCalculatorLang.moretag.description,50)}var l="moretag";return a.prototype.init=function(a,l){var o="#lix-calculator-"+LixCalculator.slugify(this.formulaId),r=l.match(/<!--more-->/g)?l.match(/<!--more-->/g).length:0,i="#5DAE00",n=LixCalculatorLang.yes,e=LixCalculatorLang.moretag.has;r||(i="#FF1300",n=LixCalculatorLang.no,e=LixCalculatorLang.moretag.missing),t(o).find("em.value").html(n).css({color:i}),t(o).find("span.value").html(e).css({color:i})},new a}(jQuery),LixCalculator=LixCalculator||{},LixCalculator.Formula=LixCalculator.Formula||{},LixCalculator.Formula.Paragraph=function(t){function a(){this.formulaId=l,LixCalculator.addFormula(this,LixCalculatorLang.paragraph.title,LixCalculatorLang.paragraph.description,20)}var l="paragraph";return a.prototype.init=function(t){var a=this.getParamsFromText(t),l=this.calculate(a.sentences,a.paragraphs);this.output(l)},a.prototype.output=function(a){var l="#lix-calculator-"+LixCalculator.slugify(this.formulaId),o="#5DAE00",r=LixCalculatorLang.paragraph.good;a<1&&(o="#FF1300",r=LixCalculatorLang.paragraph.low),a>=5&&(o="#FF1300",r=LixCalculatorLang.paragraph.high),a=100*a,a>100&&a<500&&(a=100),LixCalculator.Formula.Total.appendTotal(a,100),a=a.toFixed(2)+"%",t(l).find("em.value").html(a).css({color:o}),t(l).find("span.value").html(r).css({color:o})},a.prototype.calculate=function(t,a){if(0==t&&0==a)return 0;var l=t/a;return l=l},a.prototype.getParamsFromText=function(t){return{sentences:LixCalculator.getSentences(t),paragraphs:LixCalculator.getParagraphs(t)}},new a}(jQuery),LixCalculator=LixCalculator||{},LixCalculator.Formula=LixCalculator.Formula||{},LixCalculator.Formula.Total=function(t){function a(){this.formulaId=l,LixCalculator.addFormula(this,LixCalculatorLang.total.title,LixCalculatorLang.total.description,1e3)}var l="total",o=0,r=0,i=0;return a.prototype.init=function(t){},a.prototype.appendTotal=function(t,a){o+=t,r+=a,i=o/r*100,i=i.toFixed(2),this.output(i)},a.prototype.output=function(a){var l="#lix-calculator-"+LixCalculator.slugify(this.formulaId),o="#f2b127",r=LixCalculatorLang.total.ok;a<40&&(o="#FF1300",r=LixCalculatorLang.total.bad),a>=60&&(o="#5DAE00",r=LixCalculatorLang.total.good),a+="%",t(l).find("em.value").html(a).css({color:o}),t(l).find("span.value").html(r).css({color:o})},a.prototype.resetTotal=function(){o=0,r=0,i=0},new a}(jQuery);