var LixCalculator=function(t){function a(){0!==t("#content").length&&t(window).load(function(){this.init()}.bind(this))}var l,r,o,i=t("#lix-calculator-content"),e=[],n=300;return a.prototype.init=function(){setTimeout(function(){tinymce.get("content")&&(r=tinymce.get("content"),r.off("keyup"),this.calculate("visual",this.trimContent(r.getContent({format:"text"})),r.getContent({format:"html"})),r.on("keyup",function(){clearTimeout(l),l=setTimeout(function(){this.calculate("visual",this.trimContent(r.getContent({format:"text"})),r.getContent({format:"html"}))}.bind(this),n)}.bind(this)))}.bind(this),1e3),o=t("textarea#content"),o.off("keyup"),this.calculate("text",this.trimContent(o.val()),wp.editor.autop(o.val())),o.on("keyup",function(){clearTimeout(l),l=setTimeout(function(){this.calculate("text",this.trimContent(o.val()),wp.editor.autop(o.val()))}.bind(this),n)}.bind(this))},a.prototype.trimContent=function(t){return t=t.replace(/<\/?[^>]+(>|$)/g,""),t=t.replace(/\t/g,"")},a.prototype.calculate=function(a,l,r){t.each(e,function(t,a){a.obj.init(l,r)}.bind(this))},a.prototype.addFormula=function(a,l,r,o){"undefined"==typeof o&&(o=10);var n=!1,u='<div class="col" id="lix-calculator-'+this.slugify(a.formulaId)+'" data-priority="'+o+'">                <label>                    '+l+"                    <small>"+r+'</small>                </label>                <div class="values">                    <em class="value">'+LixCalculatorLang.na+'</em>                    <span class="value">'+LixCalculatorLang.na+"</span>                </div>            </div>",c=i.find(".col").filter(function(){return parseInt(t(this).attr("data-priority"))<=o}).last();c.length||(c=i.find(".col").filter(function(){return parseInt(t(this).attr("data-priority"))>o}).first(),c.length&&(c.before(u),n=!0),c={}),!n&&c.length?c.after(u):n||i.append(u),e.push({obj:a,title:l,description:r})},a.prototype.slugify=function(t){return t.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},a.prototype.getSentences=function(t){return t.trim().length>0&&t.trim().match(/([^\.\!\?]+[\.\?\!]*)/g)?t.trim().match(/([^\.\!\?]+[\.\?\!]*)/g).length:0},a.prototype.getParagraphs=function(t){return t.trim().length>0&&t.trim().split(/[\r\n][\r\n]+/)?t.trim().split(/[\r\n][\r\n]+/).length:0},new a}(jQuery);LixCalculator=LixCalculator||{},LixCalculator.Formula=LixCalculator.Formula||{},LixCalculator.Formula.Headline=function(t){function a(){this.formulaId=l,LixCalculator.addFormula(this,LixCalculatorLang.headline.title,LixCalculatorLang.headline.description,30)}var l="headline";return a.prototype.init=function(t,a){this.calculate(a)},a.prototype.calculate=function(a){var l="#lix-calculator-"+LixCalculator.slugify(this.formulaId),r=this.getParamsFromText(a),o=r.paragraphs/r.headlines;o=o.toFixed(0);var i="#5DAE00",e=LixCalculatorLang.paragraph.good;o<1&&(i="#FF1300",e=LixCalculatorLang.paragraph.low),5==o&&(i="#FFB700",e=LixCalculatorLang.total.ok),o>=6&&(i="#FF1300",e=LixCalculatorLang.paragraph.high),t(l).find("span.value").html(o).css({color:i}),t(l).find("em.value").html(e).css({color:i})},a.prototype.getParamsFromText=function(t){return{headlines:t.match(/<h(\d)>(.*)?<\/h(\d)>/gi)?t.match(/<h(\d)>(.*)?<\/h(\d)>/gi).length+1:1,paragraphs:t.match(/<p>/gi)?t.match(/<p>/gi).length:0}},new a}(jQuery),LixCalculator=LixCalculator||{},LixCalculator.Formula=LixCalculator.Formula||{},LixCalculator.Formula.Lix=function(t){function a(){this.formulaId=l,LixCalculator.addFormula(this,LixCalculatorLang.lix.title,LixCalculatorLang.lix.description,10)}var l="lix";return a.prototype.init=function(t){var a=this.getParamsFromText(t),l=this.calculate(a.words,a.longWords,a.sentences),r=this.getReadability(l);this.output(l,r)},a.prototype.output=function(a,l){var r="#lix-calculator-"+LixCalculator.slugify(this.formulaId);t(r).find("span.value").html(a).css({color:l.textColor}),t(r).find("em.value").html(l.value).css({color:l.textColor})},a.prototype.getReadability=function(t){var a=LixCalculatorLang.na,l="#ddd";return t<30?(a=LixCalculatorLang.lix.very_easy,l="#5DAE00"):t>29&&t<41?(a=LixCalculatorLang.lix.easy,l="#5DAE00"):t>40&&t<51?(a=LixCalculatorLang.lix.moderate,l="#FFB700"):t>50&&t<61?(a=LixCalculatorLang.lix.hard,l="#FF9600"):t>60&&(a=LixCalculatorLang.lix.very_hard,l="#FF1300"),{value:a,textColor:l}},a.prototype.calculate=function(t,a,l){if(0===t)return 0;var r=t/l+a/t*100;return r.toFixed(0)},a.prototype.getParamsFromText=function(t){return{words:t.trim().length>0&&null!==t.trim().match(/\S+/g)?t.trim().match(/\S+/g).length:0,longWords:t.trim().length>0&&null!==t.trim().match(/(\S+){7,}/g)?t.trim().match(/[\S+]{7,}/g).length:0,sentences:LixCalculator.getSentences(t)}},new a}(jQuery),LixCalculator=LixCalculator||{},LixCalculator.Formula=LixCalculator.Formula||{},LixCalculator.Formula.Moretag=function(t){function a(){this.formulaId=l,LixCalculator.addFormula(this,LixCalculatorLang.moretag.title,LixCalculatorLang.moretag.description,50)}var l="moretag";return a.prototype.init=function(a,l){var r="#lix-calculator-"+LixCalculator.slugify(this.formulaId),o=l.match(/<!--more-->/g)?l.match(/<!--more-->/g).length:0,i="#5DAE00",e=LixCalculatorLang.yes,n=LixCalculatorLang.moretag.has;o||(i="#FF1300",e=LixCalculatorLang.no,n=LixCalculatorLang.moretag.missing),t(r).find("em.value").html(e).css({color:i}),t(r).find("span.value").html(n).css({color:i})},new a}(jQuery),LixCalculator=LixCalculator||{},LixCalculator.Formula=LixCalculator.Formula||{},LixCalculator.Formula.Paragraph=function(t){function a(){this.formulaId=l,LixCalculator.addFormula(this,LixCalculatorLang.paragraph.title,LixCalculatorLang.paragraph.description,20)}var l="paragraph";return a.prototype.init=function(t){var a=this.getParamsFromText(t),l=this.calculate(a.sentences,a.paragraphs);this.output(l)},a.prototype.output=function(a){var l="#lix-calculator-"+LixCalculator.slugify(this.formulaId),r="#5DAE00",o=LixCalculatorLang.paragraph.good;a=a.toFixed(0),a<1&&(r="#FF1300",o=LixCalculatorLang.paragraph.low),5==a&&(r="#FFB700",o=LixCalculatorLang.total.ok),a>=6&&(r="#FF1300",o=LixCalculatorLang.paragraph.high),t(l).find("span.value").html(a).css({color:r}),t(l).find("em.value").html(o).css({color:r})},a.prototype.calculate=function(t,a){if(0==t&&0==a)return 0;var l=t/a;return l=l},a.prototype.getParamsFromText=function(t){return{sentences:LixCalculator.getSentences(t),paragraphs:LixCalculator.getParagraphs(t)}},new a}(jQuery);