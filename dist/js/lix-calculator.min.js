var LixCalculator={};LixCalculator=LixCalculator||{},LixCalculator.Modules=LixCalculator.Modules||{},LixCalculator.Modules.Lix=function(t){function a(){t(window).load(function(){this.bindEvents()}.bind(this)),t("#content-tmce, #content-html").on("click",function(){this.bindEvents()}.bind(this))}var e,o="#lix-calculator-content",n=500;return a.prototype.bindEvents=function(){if(0!==t("#content").length){var a,o;setTimeout(function(){tinymce.get("content")&&(a=tinymce.get("content"),a.off("keyup"),this.calculateAndOutput(a.getContent({format:"text"})),a.on("keyup",function(){clearTimeout(e),e=setTimeout(function(){this.calculateAndOutput(a.getContent({format:"text"}))}.bind(this),n)}.bind(this)))}.bind(this),1e3),o=t("textarea#content"),o.off("keyup"),this.calculateAndOutput(o.val().replace(/<\/?[^>]+(>|$)/g,"")),o.on("keyup",function(){clearTimeout(e),e=setTimeout(function(){this.calculateAndOutput(o.val().replace(/<\/?[^>]+(>|$)/g,""))}.bind(this),n)}.bind(this))}},a.prototype.calculateAndOutput=function(t){var a=this.parseText(t),e=this.calculate(a.words,a.longWords,a.sentences);this.paragraphRatio(a.sentences,a.paragraphs),this.getWordFrequency(t);this.output(e)},a.prototype.paragraphRatio=function(a,e){var n=a/e;if(n=n.toFixed(2),"NaN"==n)return void t(o).find(".value.parahraph-ratio, .value.paragraph-ratio-rating").html(LixCalculatorLang.na).attr("style","");var r="#5DAE00",l="#fff",i=LixCalculatorLang.good;n<1&&(r="#FF1300",l="#fff",i=LixCalculatorLang.low),n>=5&&(r="#FF1300",l="#fff",i=LixCalculatorLang.high),t(o).find(".value.parahraph-ratio").html(n).css({backgroundColor:r,color:l}),t(o).find(".value.paragraph-ratio-rating").html(i).css({backgroundColor:r,color:l})},a.prototype.getWordFrequency=function(a){a=a.toLowerCase();var e=a.split(/[\s*\.*\,\;\+?\#\|:\-\/\\\[\]\(\)\{\}$%&0-9*]/),o=[];return t.each(e,function(t,a){a.length<2||(o[a]?o[a].count++:o[a]={word:a,count:1})}),o},a.prototype.parseText=function(t){return t?(t=t.replace(/\[(.*)\]/g,""),{characters:t.length,words:t.trim().length>0&&null!==t.trim().match(/\S+/g)?t.trim().match(/\S+/g).length:0,longWords:t.trim().length>0&&null!==t.trim().match(/(\S+){7,}/g)?t.trim().match(/[\S+]{7,}/g).length:0,sentences:t.trim().length>0?t.trim().match(/([^\.\!\?]+[\.\?\!]*)/g).length:0,paragraphs:t.trim().length>0?t.trim().split(/[\r\n]+/).length:0}):{characters:0,words:0,longWords:0,sentences:0,paragraphs:0}},a.prototype.calculate=function(t,a,e){if(0===t)return LixCalculatorLang.na;var o=t/e+a/t*100;return o.toFixed(2)},a.prototype.getReadability=function(t){useParentheses="undefined"!=typeof useParentheses&&useParentheses,useColor="undefined"!=typeof useColor&&useColor;var a=LixCalculatorLang.na,e="#ddd",o="#000";return t<30?(a=LixCalculatorLang.very_easy,e="#098400",o="#fff"):t>29&&t<41?(a=LixCalculatorLang.easy,e="#5DAE00",o="#fff"):t>40&&t<51?(a=LixCalculatorLang.moderate,e="#FFDC00",o="#000"):t>50&&t<61?(a=LixCalculatorLang.hard,e="#FF9600",o="#000"):t>60&&(a=LixCalculatorLang.very_hard,e="#FF1300",o="#fff"),{value:a,bgColor:e,textColor:o}},a.prototype.output=function(a){var e=this.getReadability(a);t(o).find(".value.lix").html(a).css({backgroundColor:e.bgColor,color:e.textColor}),t(o).find(".value.readability").html(e.value).css({backgroundColor:e.bgColor,color:e.textColor})},new a}(jQuery);